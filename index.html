<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Карточный Кликер</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 15px rgba(255,255,0,0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 25px rgba(255,255,0,0.8); }
            100% { transform: scale(1); box-shadow: 0 0 15px rgba(255,255,0,0.5); }
        }

        body {
            font-family: 'Press Start 2P', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a4d0a, #1a5d1a);
            color: white;
            min-height: 100vh;
            overflow: hidden;
        }

        body, button, #cards-container, .card, .loading-screen, .combo-alert, .combo-alert-ad {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;

            -webkit-touch-callout: none;
            user-drag: none;
            overscroll-behavior: contain;
        }

        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 150%;
            height: 150%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Cpath fill='%232a7d2a' fill-opacity='0.1' d='M0 0h20v20H0V0zm2 2h16v16H2V2zm6 6h8v8H8V8z'/%3E%3C/svg%3E") repeat;
            transform: rotate(-45deg);
            z-index: -1;
        }

        #game {
            position: relative;
            z-index: 1;
            margin: 100px 160px 20px;
        }

        .card {
            display: inline-block;
            width: 100px;
            height: 140px;
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            border-radius: 12px;
            margin: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            vertical-align: top;
            transition: transform 0.2s;
            font-size: 28px;
            position: relative;
            overflow: hidden;
        }

        .card.red {
            color: #c8102e;
            /*background: linear-gradient(135deg, #ffcccc, #ff6666);*/
            border: solid 1px #c8102e;
        }

        .card.black {
            color: #000000;
            /*background: linear-gradient(135deg, #333, #999);*/
            border: solid 1px #000000;
        }

        .card-content {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .rank {
            font-size: 20px;
            position: absolute;
        }

        .rank.top { top: 5px; left: 5px; }
        .rank.bottom { bottom: 5px; right: 5px; transform: rotate(180deg); }
        .suit { font-size: 40px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }

        .card-bonus {
            position: absolute;
            bottom: 5px;
            width: 100%;
            font-size: 14px;
            color: yellow;
            text-shadow: 1px 1px 2px black;
            display: none;
        }

        .card.highlight {
            animation: pulse 0.5s;
            transform: scale(1.1);
            border: 3px solid gold;
        }

        #click-button {
            padding: 20px 40px;
            font-family: 'Press Start 2P';
            font-size: 24px;
            background: linear-gradient(45deg, #ffcc00, #ff9900);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255,153,0,0.5);
            transition: all 0.3s;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 20px;
            position: relative;
            overflow: hidden;
        }

        #click-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,153,0,0.7);
        }

        #click-button:active {
            transform: translateY(0);
        }

        #click-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent 25%, rgba(255,255,255,0.3), transparent 75%);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
		
		@keyframes success {
            0% { background-color: #66ff66; }
            100% { background-color: inherit; }
        }

        #score {
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 20px;
        }

        #upgrade {
            white-space: normal;

            font-family: 'Press Start 2P', sans-serif;
            position: fixed;
            padding: 12px 25px;
            background: linear-gradient(45deg, #00ff99, #00cc66);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 3px 8px rgba(0,204,102,0.5);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            margin: 5px 0;
            display: block;

            left: 50%;
            transform: translateX(-50%);
            top: 5px;
            width: 360px;
            z-index: 10;
        }

        #suit-upgrades {
            font-family: 'Press Start 2P', sans-serif;
            position: fixed;
            top: 5px;
            right: 5px;
            text-align: right;
        }

        .suit-upgrade {
            font-family: 'Press Start 2P', sans-serif;
            display: block;
            width: 160px;
            padding: 8px 15px;
            background: linear-gradient(45deg, #6666ff, #4d4dff);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            margin: 5px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .suit-bonus {
            margin-top: 5px;
            font-size: 14px;
            color: #ccc;
        }

		#rewarded-video {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 12px 25px;
            background: linear-gradient(45deg, #ff6666, #cc0000);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 3px 8px rgba(204,0,0,0.5);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .combo-alert {
            margin: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #ffff66, #ffcc00);
            color: #333;
            border-radius: 10px;
            display: none;
            font-size: 20px;
            text-shadow: 1px 1px 2px white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            animation: fadeInOut 2s; /* Анимация появления и исчезновения */
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .combo-alert-ad {
            position: fixed;
            top: 5rem;
            margin: 20px auto;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px;
            background: linear-gradient(45deg, #ffff66, #ffcc00);
            color: #333;
            border-radius: 10px;
            display: none;
            font-size: 20px;
            text-shadow: 1px 1px 2px white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1001;
        }

        .loading-screen, .pause-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(50, 50, 50, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .loading-screen {
            z-index: 1002;
        }

        .pause-screen {
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
        }

        #fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10000;
        }

        @keyframes explode {
			0% { 
				transform: translate(-50%, -50%) scale(0); 
				opacity: 1; 
			}
			50% { 
				transform: translate(-50%, -50%) scale(1); 
				opacity: 1; 
			}
			100% { 
				transform: translate(-50%, -50%) scale(1.5); 
				opacity: 0; 
			}
		}
		
		@keyframes explode-particle {
			0% { 
				transform: translate(-50%, -50%) scale(1) rotate(var(--angle)); 
				opacity: 1;
			}
			100% { 
				transform: translate(-50%, -50%) 
					   scale(3) 
					   rotate(calc(var(--angle) + 720deg)) 
					   translate(0, 100px);
				opacity: 0;
			}
		}
		
		#fireworks-container {
			pointer-events: none;
			z-index: 9998; /* Ниже кнопки (z-index: 10) но выше фона */
		}

		.firework {
			position: fixed;
			top: 50%;
			left: 50%;
			animation: explode 1s ease-out;
			opacity: 0;
			z-index: 9999;
			width: 150px;
			height: 150px;
		}

        /* Мобильная адаптация */
		@media (max-width: 960px), (max-height: 600px) {
            body {
                margin: 0 auto;
                padding: 0 10px 0 0;
            }

			body::before {
				width: 100%;
				height: 100%;
			}

            #game {
				width: calc(100% - 115px);
				margin: 65px 0;
            }

            #cards-container {
                white-space: nowrap;
                overflow-x: auto;
                padding-bottom: 0;
            }

            .card {
                max-width: 60px;
                height: 85px;
                font-size: 16px;
                margin: 8px 5px;
            }

			.rank {
				font-size: 16px;
			}

			.suit {
				font-size: 24px;
				transform: translate(-50%, -60%);
			}

            #click-button {
                padding: 12px 24px;
                font-size: 16px;
                margin: 10px auto;
                display: block;
                width: 280px;
            }

			#score {
				font-size: 20px;
				margin: 12px 16px;
			}

            #upgrade {
				font-size: 14px;
                left: calc(50% - 70px);
				z-index: 10;
            }

            #suit-upgrades {
                position: fixed;
                top: 2px;
                right: 5px;
                text-align: right;
                display: flex;
                flex-direction: column;
                align-items: flex-end;
                gap: 5px;
                z-index: 10;
            }

            .suit-upgrade {
                width: 115px;
                padding: 0 8px 4px;
                font-size: 12px;
				margin-top: 0;
                background: linear-gradient(45deg, #00ff99, #6666ff);
            }

            .suit-bonus {
                font-size: 10px;
                margin-top: 3px;
            }

			#rewarded-video {
				bottom: 2px;
				top: unset;
				left: unset;
				right: 2px;
				max-width: 180px;
				padding: 4px;
				font-size: 14px;
			}

			.combo-alert-ad {
				top: 20%;
				width: 90%;
				font-size: 14px;
			}

			#suit-upgrades {
				top: 2px;
				right: 2px;
				gap: 3px;
			}

			.suit-upgrade {
				width: 120px;
				padding: 4px;
				font-size: 10px;
			}

			.suit-bonus {
				font-size: 10px;
			}

			#upgrade {
				top: 0;
				width: 280px;
				font-size: 12px;
			}
        }

		@media (max-height: 360px) {
			#game {
				margin: 50px 0;
			}

			.combo-alert {
				position: fixed;
				top: 10%;
				margin: 20px auto;
				left: calc(50% - 70px);
				transform: translateX(-50%);
				padding: 12px;
				background: linear-gradient(45deg, #ffff66, #ffcc00);
				color: #333;
				border-radius: 10px;
				font-size: 14px;
				text-shadow: 1px 1px 2px white;
				box-shadow: 0 2px 5px rgba(0,0,0,0.3);
				z-index: 9;
			}

			.card {
				width: 45px;
				height: 65px;
				margin: 3px;
			}

			.rank {
				font-size: 10px;
			}

			.suit {
				font-size: 20px;
			}

			#click-button {
				width: 240px;
				padding: 12px;
				font-size: 14px;
				margin: 5px auto;
			}
		}
    </style>
</head>
<body oncontextmenu="return false;">
    <div id="game">
        <div id="cards-container"></div>
        <div id="score">Очки: 0</div>
        <button id="click-button" onclick="generateCard()">Клик!</button>
        <div id="combo-alert" class="combo-alert"></div>
    </div>

    <div id="fireworks-container"></div>

    <template id="firework-template">
        <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="80 90 150 10" fill="none">
		<g xmlns="http://www.w3.org/2000/svg">
				<path style="fill:#FCE24C;" d="M150.516,90.387c-0.101,0.023-0.203,0.047-0.296,0.078l-11.138-34.334    c-0.702-2.143-0.047-3.39,1.044-3.687c1.091-0.289,2.268,0.452,2.743,2.642L150.516,90.387z"/>
				<path style="fill:#FCE24C;" d="M165.941,147.651c-1.083,0.296-2.268-0.444-2.744-2.635l-7.747-35.744    c0.086-0.023,0.172-0.054,0.257-0.078l11.286,34.778C167.687,146.116,167.032,147.363,165.941,147.651z"/>
				<path style="fill:#FCE24C;" d="M148.38,91.174c-0.187,0.094-0.366,0.195-0.538,0.296l-17.997-27.724    c-1.224-1.894-0.92-3.266,0.062-3.835c0.974-0.561,2.307-0.148,3.328,1.839L148.38,91.174z"/>
				<path style="fill:#FCE24C;" d="M176.751,140.699c-0.974,0.569-2.307,0.156-3.336-1.839l-15.713-30.546    c0.14-0.078,0.281-0.164,0.413-0.257l18.698,28.815C178.037,138.766,177.734,140.138,176.751,140.699z"/>
				<path style="fill:#FCE24C;" d="M146.37,92.796l-0.14-0.125l-28.971-26.095c-1.668-1.512-1.73-2.915-0.927-3.718    c0.795-0.795,2.182-0.748,3.695,0.912l26.22,28.885L146.37,92.796z"/>
				<path style="fill:#FCE24C;" d="M188.154,134.744c-0.795,0.795-2.182,0.74-3.694-0.92l-24.645-27.163    c0.062-0.062,0.117-0.117,0.171-0.179l27.241,24.544C188.895,132.538,188.957,133.941,188.154,134.744z"/>
				<path style="fill:#FCE24C;" d="M144.179,95.305c-0.078,0.148-0.156,0.304-0.226,0.46l-30.359-15.479    c-2.003-1.021-2.424-2.369-1.863-3.344c0.561-0.974,1.917-1.286,3.803-0.078L144.179,95.305z"/>
				<path style="fill:#FCE24C;" d="M193.595,122.99c-0.569,0.974-1.925,1.286-3.811,0.07l-28.504-18.348    c0.094-0.156,0.179-0.312,0.257-0.468l30.195,15.401C193.735,120.668,194.156,122.008,193.595,122.99z"/>
				<path style="fill:#FCE24C;" d="M143.377,97.347c-0.016,0.078-0.039,0.156-0.055,0.234l-35.986-7.662    c-2.206-0.468-2.962-1.66-2.665-2.751c0.288-1.083,1.52-1.738,3.655-1.052L143.377,97.347z"/>
				<path style="fill:#FCE24C;" d="M200.15,111.509c-0.288,1.091-1.52,1.746-3.655,1.06l-34.092-10.928    c0.023-0.109,0.039-0.218,0.062-0.335l35.019,7.459C199.69,109.234,200.446,110.418,200.15,111.509z"/>
				<path style="fill:#FCE24C;" d="M143.307,102.125l-34.934,11.341c-2.143,0.694-3.39,0.039-3.687-1.052    c-0.288-1.083,0.452-2.268,2.642-2.744l35.924-7.786C143.275,101.962,143.291,102.047,143.307,102.125z"/>
				<path style="fill:#FCE24C;" d="M198.622,89.841l-36.298,7.865c-0.016-0.07-0.031-0.14-0.047-0.203l35.3-11.45    c2.143-0.694,3.39-0.047,3.679,1.045C201.553,88.189,200.812,89.366,198.622,89.841z"/>
				<path style="fill:#FCE24C;" d="M144.351,104.736l-29.712,19.275c-1.886,1.231-3.266,0.92-3.827-0.054    c-0.561-0.982-0.156-2.307,1.839-3.336l31.512-16.212C144.226,104.518,144.281,104.627,144.351,104.736z"/>
				<path style="fill:#FCE24C;" d="M191.319,80.216l-29.774,15.308c-0.086-0.172-0.172-0.335-0.273-0.499l28.059-18.207    c1.886-1.224,3.258-0.92,3.827,0.062C193.719,77.854,193.314,79.187,191.319,80.216z"/>
				<path style="fill:#FCE24C;" d="M146.315,106.724l-0.21,0.234l-26.009,28.87c-1.512,1.676-2.915,1.738-3.718,0.935    c-0.795-0.795-0.748-2.19,0.912-3.695l28.792-26.134L146.315,106.724z"/>
				<path style="fill:#FCE24C;" d="M188.731,67.067l-28.8,26.142l-0.226,0.203l0.203-0.226l26.025-28.878    c1.512-1.676,2.915-1.73,3.718-0.935C190.446,64.175,190.391,65.563,188.731,67.067z"/>
				<path style="fill:#FCE24C;" d="M147.983,108.353l-15.986,31.348c-1.021,2.003-2.369,2.424-3.344,1.863    c-0.974-0.561-1.294-1.917-0.078-3.803l19.065-29.61C147.749,108.22,147.866,108.29,147.983,108.353z"/>
				<path style="fill:#FCE24C;" d="M176.182,63.684l-18.036,28.02c-0.164-0.109-0.335-0.211-0.507-0.312l15.129-29.649    c1.021-2.011,2.362-2.432,3.344-1.863C177.087,60.442,177.398,61.798,176.182,63.684z"/>
				<path style="fill:#FCE24C;" d="M151.186,109.499l-7.568,35.542c-0.476,2.206-1.66,2.962-2.751,2.665    c-1.091-0.288-1.738-1.52-1.06-3.655l11.099-34.606C150.999,109.467,151.093,109.483,151.186,109.499z"/>
				<path style="fill:#FCE24C;" d="M166.931,56.085l-11.068,34.521c-0.094-0.039-0.187-0.062-0.281-0.094l7.545-35.417    c0.468-2.206,1.66-2.954,2.751-2.666C166.962,52.718,167.617,53.949,166.931,56.085z"/>
				<polygon style="fill:#FCE24C;" points="146.081,106.934 146.315,106.724 146.105,106.958   "/>
				<path style="fill:#FCE24C;" d="M146.245,92.655l0.125,0.14l-0.14-0.125C146.229,92.671,146.237,92.663,146.245,92.655z"/>
				<path style="fill:#FCE24C;" d="M159.908,93.185c0.016,0.008,0.023,0.015,0.023,0.023l-0.226,0.203L159.908,93.185z"/>
				<g>
					<g>
						<path style="fill:#FCE24C;" d="M97.426,100.84H88.14c-0.43,0-0.779-0.349-0.779-0.779c0-0.43,0.349-0.779,0.779-0.779h9.286      c0.43,0,0.779,0.349,0.779,0.779C98.205,100.491,97.856,100.84,97.426,100.84z"/>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M99.947,100.84c0.044,0,0.089,0,0.133,0c1.003,0,1.005-1.559,0-1.559c-0.044,0-0.089,0-0.133,0       C98.944,99.281,98.942,100.84,99.947,100.84L99.947,100.84z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M102.6,100.84c1.003,0,1.005-1.559,0-1.559C101.597,99.281,101.596,100.84,102.6,100.84       L102.6,100.84z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M105.254,100.707c1.003,0,1.005-1.559,0-1.559C104.251,99.148,104.249,100.707,105.254,100.707       L105.254,100.707z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M143.049,99.873c0,0.195,0.008,0.382,0.023,0.569h-35.167c-1.006,0-0.998-1.559,0-1.559h35.191       C143.065,99.21,143.049,99.538,143.049,99.873z"/>
						</g>
					</g>
				</g>
				<g>
					<g>
						<path style="fill:#FCE24C;" d="M152.609,50.905c-0.43,0-0.779-0.349-0.779-0.779v-9.287c0-0.43,0.349-0.779,0.779-0.779      c0.43,0,0.779,0.349,0.779,0.779v9.287C153.389,50.556,153.04,50.905,152.609,50.905z"/>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M151.83,52.647c0,0.044,0,0.089,0,0.133c0,1.003,1.559,1.005,1.559,0c0-0.044,0-0.089,0-0.133       C153.389,51.644,151.83,51.642,151.83,52.647L151.83,52.647z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M152.609,56.079c1.003,0,1.005-1.559,0-1.559C151.606,54.521,151.605,56.079,152.609,56.079       L152.609,56.079z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M152.742,58.733c1.003,0,1.005-1.559,0-1.559C151.739,57.174,151.738,58.733,152.742,58.733       L152.742,58.733z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M153.79,60.605v29.556c-0.32-0.031-0.647-0.047-0.982-0.047c-0.195,0-0.39,0.008-0.577,0.023       V60.605C152.231,59.6,153.79,59.6,153.79,60.605z"/>
						</g>
					</g>
				</g>
				<g>
					<g>
						<path style="fill:#FCE24C;" d="M153.206,160.242c-0.43,0-0.779-0.349-0.779-0.779v-9.286c0-0.43,0.349-0.779,0.779-0.779      s0.779,0.349,0.779,0.779v9.286C153.986,159.893,153.637,160.242,153.206,160.242z"/>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M153.986,147.656c0-0.044,0-0.089,0-0.133c0-1.003-1.559-1.005-1.559,0c0,0.044,0,0.089,0,0.133       C152.427,148.658,153.986,148.66,153.986,147.656L153.986,147.656z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M153.206,145.782c1.003,0,1.005-1.559,0-1.559C152.203,144.223,152.202,145.782,153.206,145.782       L153.206,145.782z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M153.074,143.128c1.003,0,1.005-1.559,0-1.559C152.071,141.569,152.069,143.128,153.074,143.128       L153.074,143.128z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M153.587,109.6v30.094c0,1.005-1.559,1.005-1.559,0V109.6c0.257,0.023,0.514,0.031,0.779,0.031       C153.073,109.631,153.33,109.623,153.587,109.6z"/>
						</g>
					</g>
				</g>
				<g>
					<g>
						<path style="fill:#FCE24C;" d="M217.875,100.641h-9.287c-0.43,0-0.779-0.349-0.779-0.779c0-0.43,0.349-0.779,0.779-0.779h9.287      c0.43,0,0.779,0.349,0.779,0.779C218.655,100.292,218.306,100.641,217.875,100.641z"/>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M206.068,99.082c-0.044,0-0.088,0-0.133,0c-1.003,0-1.005,1.559,0,1.559       c0.044,0,0.088,0,0.133,0C207.071,100.641,207.073,99.082,206.068,99.082L206.068,99.082z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M203.414,100.641c1.003,0,1.005-1.559,0-1.559C202.411,99.082,202.41,100.641,203.414,100.641       L203.414,100.641z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M200.761,100.508c1.003,0,1.005-1.559,0-1.559C199.758,98.949,199.757,100.508,200.761,100.508       L200.761,100.508z"/>
						</g>
					</g>
					<g>
						<g>
							<path style="fill:#FCE24C;" d="M198.108,100.239h-35.549c0.008-0.117,0.008-0.242,0.008-0.366c0-0.405-0.023-0.803-0.07-1.193       h35.612C199.113,98.68,199.113,100.239,198.108,100.239z"/>
						</g>
					</g>
				</g>
				<g>
					<g>
						<path style="fill:#FCE24C;" d="M126.945,56.645c2.006,0,2.009-3.118,0-3.118C124.939,53.527,124.935,56.645,126.945,56.645      L126.945,56.645z"/>
					</g>
					<g>
						<path style="fill:#FCE24C;" d="M113.413,142.812c2.006,0,2.009-3.118,0-3.118C111.407,139.695,111.403,142.812,113.413,142.812      L113.413,142.812z"/>
					</g>
					<g>
						<path style="fill:#FCE24C;" d="M180.277,148.384c2.006,0,2.009-3.118,0-3.118C178.271,145.267,178.268,148.384,180.277,148.384      L180.277,148.384z"/>
					</g>
					<g>
						<path style="fill:#FCE24C;" d="M201.371,126.693c0.066,0,0.133,0,0.199,0c0.815,0,1.596-0.717,1.559-1.559      c-0.038-0.844-0.685-1.559-1.559-1.559c-0.066,0-0.133,0-0.199,0c-0.815,0-1.596,0.717-1.559,1.559      C199.85,125.979,200.497,126.693,201.371,126.693L201.371,126.693z"/>
					</g>
					<g>
						<path style="fill:#FCE24C;" d="M178.287,56.247c2.006,0,2.01-3.118,0-3.118C176.281,53.129,176.278,56.247,178.287,56.247      L178.287,56.247z"/>
					</g>
					<g>
						<path style="fill:#FCE24C;" d="M97.891,115.35c2.006,0,2.009-3.118,0-3.118C95.884,112.232,95.881,115.35,97.891,115.35      L97.891,115.35z"/>
					</g>
					<g>
						<path style="fill:#FCE24C;" d="M197.026,74.787c0,0.066,0,0.133,0,0.199c0,0.815,0.717,1.597,1.559,1.559      c0.845-0.038,1.559-0.685,1.559-1.559c0-0.066,0-0.133,0-0.199c0-0.815-0.717-1.597-1.559-1.559      C197.741,73.266,197.026,73.913,197.026,74.787L197.026,74.787z"/>
					</g>
				</g>
			</g>
		</svg>
    </template>

    <div id="combo-alert-ad" class="combo-alert-ad"></div>

    <div id="loading-screen" class="loading-screen">Загрузка...</div>
    <div id="pause-screen" class="pause-screen">Пауза</div>

    <button id="upgrade" onclick="upgradeMaxCards()">Улучшить (250)</button>

    <div id="suit-upgrades">
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♥" onclick="upgradeSuit('♥')">♥ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♥">♥ Уровень: 0</div>
        </div>
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♠" onclick="upgradeSuit('♠')">♠ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♠">♠ Уровень: 0</div>
        </div>
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♦" onclick="upgradeSuit('♦')">♦ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♦">♦ Уровень: 0</div>
        </div>
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♣" onclick="upgradeSuit('♣')">♣ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♣">♣ Уровень: 0</div>
        </div>
    </div>

    <button id="rewarded-video" onclick="showRewardedVideo()">Посмотреть видео, получить награду</button>

    <script src="https://yandex.ru/games/sdk/v2"></script>

    <script>
        const locales = {
            en: {
                level: "Level: ",
                score: "Score: ",
                clickButton: "Click!",
                maxCards: "cards",
                upgradeButton: "Upgrade (",
                suitUpgrade: "Enhance (",
                maxLevel: "MAX",
                rewardedButton1: "Watch video, get ",
                rewardedButton2: " points",
                loading: "Loading...",
                paused: "Paused",
                combinations: {
                    pair: "Pair",
                    twoPairs: "Two Pairs",
                    three: "Three of a Kind",
                    straight: "Straight",
                    flush: "Flush",
                    fullHouse: "Full House",
                    four: "Four of a Kind",
                    straightFlush: "Straight Flush",
                    royalFlush: "Royal Flush"
                },
                messages: {
                    needPoints: "Need ",
                    points: " points for upgrading",
                    pointsMaxCards: "cards maximum",
                    maxCardsReached: "Max cards reached!",
                    maxSuitReached1: "Suit ",
                    maxSuitReached2: " already at max level!",
                    adReady2: "Ad ready in 2...",
                    adReady1: "Ad ready in 1..."
                },
                clickMessages: ["Click-click!", "More!", "Press!", "Press faster!", "Well done!", "It works!", "Go ahead!", "Fantastic!", "Power!", "Come on!", "You can do it!", "You can do it", "Believe in yourself!", "Go for it!", "Don't stop!", "Keep going", "Bravo :)", "Awesome", "Professional!", "Excellent", "Unique", "Keep it up", "Top class!", "Amazing", "Masterful!"]
            },
            ru: {
                level: "Уровень: ",
                score: "Очки: ",
                clickButton: "Клик!",
                maxCards: "карт",
                upgradeButton: "Улучшить (",
                suitUpgrade: "Усилить (",
                maxLevel: "МАКСИМУМ",
                rewardedButton1: "Посмотреть видео, получить ",
                rewardedButton2: " очков",
                loading: "Загрузка...",
                paused: "Пауза",
                combinations: {
                    pair: "Пара",
                    twoPairs: "Две пары",
                    three: "Сет",
                    straight: "Стрит",
                    flush: "Флеш",
                    fullHouse: "Фулл-хаус",
                    four: "Каре",
                    straightFlush: "Стрит-флеш",
                    royalFlush: "Роял-флеш"
                },
                messages: {
                    needPoints: "Нужно ",
                    points: " очков для улучшения",
                    pointsMaxCards: "максимума карт",
                    maxCardsReached: "Достигнут максимум карт!",
                    maxSuitReached1: "Масть ",
                    maxSuitReached2: " уже усилена до максимального уровня!",
                    adReady2: "Реклама через 2 секунды...",
                    adReady1: "Реклама через 1 секунду..."
                },
                clickMessages: ["Клик-клик!", "Еще!", "Жми!", "Жми быстрее!", "Молодец!", "Получается!", "Вперед!", "Фантастика!", "Мощь!", "Давай!", "Ты сможешь!", "Ты справишься", "Верь в себя!", "Действуй!", "Не останавливайся!", "Продолжай", "Браво :)", "Бесподобно", "Профессионально!", "Великолепно", "Неповторимо", "Так держать", "Высший класс!", "Изумительно", "Мастерски!"]
            }
        };

        let currentLang = 'ru'; // По умолчанию

        let score = 0;
        let maxCards = 2;
        let cards = [];
        const suits = ['♥', '♠', '♦', '♣'];
        const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];

        let yg;
		let lb;

        let suitBonuses = {'♥':0, '♠':0, '♦':0, '♣':0};

		const maxCardCosts =        [500, 2500, 12500, 125000, 750000, 1800000, 7000000, 9999999];
        const suitUpgradeCosts =    [100, 500, 2500, 7500, 12500, 25000, 50000, 100000, 125000, 175000, 350000, 500000, 600000, 750000, 1800000, 7000000, 9999999, 19999999, 99999999];

        let rewardedBonus = 0;
        let rewardedAvailable = true;

        let comboTimeout = null;

        let adCooldown = 65000;
        let lastAdTime = 0;
        let adReady = false;
        let adActive = false;

        const yourSVGTemplate = document.getElementById('firework-template');

        document.addEventListener('keydown', (event) => {
            // Проверяем, доступен ли SDK Яндекса
            const isYandexDraft = false/*!yg || typeof yg == "undefined" || (yg && yg.environment?.draft == true)*/;

            const currentLevel = maxCards - 2;
            const nextLevelCost = maxCardCosts[currentLevel] || 10000000;

            // Сброс очков по клавише R
            if (event.key.toLowerCase() === 'r' && isYandexDraft) {
                score = 0;
                updateScore();
                saveProgress();
                showComboAlert(locales[currentLang].score + " reset to 0!");
            }
            if (event.key.toLowerCase() === 't' && isYandexDraft) {
                score += nextLevelCost;
                updateScore();
                saveProgress();
                showComboAlert(locales[currentLang].score + " reset to 0!");
            }

            // Увеличение максимума карт по NumPad +
            if (event.key === '+' && event.location === KeyboardEvent.DOM_KEY_LOCATION_NUMPAD && isYandexDraft) {
                if (maxCards < maxCardCosts.length + 2) {
                    maxCards++;
                    updateMaxCardsButton();
                    updateScore();
                    saveProgress();
                    showComboAlert(`${locales[currentLang].maxCards} ${maxCards}/${maxCardCosts.length + 2}`);
                }
            }

            // Уменьшение максимума карт по NumPad -
            if (event.key === '-' && event.location === KeyboardEvent.DOM_KEY_LOCATION_NUMPAD && isYandexDraft) {
                if (maxCards > 2) {
                    maxCards--;
                    updateMaxCardsButton();
                    updateScore();
                    saveProgress();
                    showComboAlert(`${locales[currentLang].maxCards} ${maxCards}/${maxCardCosts.length + 2}`);
                }
            }
        });

        async function init() {
            document.getElementById('loading-screen').textContent = locales[currentLang].loading;
            document.getElementById('loading-screen').style.display = 'flex';

            try {
                yg = await YaGames.init();
                yg.getLeaderboards().then(_lb => lb = _lb);

                currentLang = yg.environment.i18n?.lang?.startsWith('en') ? 'en' : 'ru';
                applyTranslations();

                yg.features.LoadingAPI?.ready();
                document.getElementById('loading-screen').style.display = 'none';

                await loadProgress();
            } catch (error) {
                console.warn("Yandex SDK unavailable or failed to initialize:", error);
                // Если SDK недоступен, все равно запускаем игру
                currentLang = 'ru'; // Устанавливаем язык по умолчанию
                applyTranslations();
                document.getElementById('loading-screen').style.display = 'none';
            }

            updateUpgrades();
            updateGameState();
            if (yg) showAd();
        }

        function applyTranslations() {
            document.getElementById('click-button').textContent = locales[currentLang].clickButton;
            document.getElementById('rewarded-video').textContent = locales[currentLang].rewardedButton1 + `25` + locales[currentLang].rewardedButton2;
            document.querySelector('title').textContent = currentLang === 'ru'
                ? 'Карточный Кликер'
                : 'Card Clicker';

            updateScore();
            updateUpgrades();
        }

        function generateCard() {
            if (adActive) return;
            const btn = document.getElementById('click-button');
            btn.style.animation = 'pulse 0.3s';
            setTimeout(() => btn.style.animation = '', 300);
            btn.textContent = locales[currentLang].clickMessages[Math.floor(Math.random() * locales[currentLang].clickMessages.length)];

            // Генерируем список доступных карт (без дубликатов)
            const availableCards = [];
            for (const suit of suits) {
                for (const rank of ranks) {
                    if (!cards.some(card => card.suit === suit && card.rank === rank)) {
                        availableCards.push({ suit, rank });
                    }
                }
            }

            if (availableCards.length === 0) {
                showComboAlert("Нет доступных карт для генерации!");
                return;
            }

            // Выбираем случайную доступную карту
            const randomIndex = Math.floor(Math.random() * availableCards.length);
            const newCard = availableCards[randomIndex];

            // Добавляем новую карту и удаляем старую, если превышен лимит
            cards.push(newCard);
            if (cards.length > maxCards) cards.shift();

            // Обновляем интерфейс и логику
            updateCardsDisplay();
            updateUpgrades();
            checkBestCombination();
            score++;
            updateScore();
            saveProgress();
            const currentTime = Date.now();
            if (currentTime - lastAdTime > adCooldown) {
                adReady = true;
            }
        }

        function showComboAlert(text) {
            if (adReady) {
                adReady = false;
                showComboAlertAd(text);
                return;
            }

            const alert = document.getElementById('combo-alert');

            if(comboTimeout) {
                clearTimeout(comboTimeout);
                comboTimeout = null;
            }

            alert.textContent = text;
            alert.style.display = 'block';

            comboTimeout = setTimeout(() => {
                alert.style.display = 'none';
                comboTimeout = null;
            }, 2000);
        }

        function showComboAlertAd(text) {
            const alert = document.getElementById('combo-alert-ad');
            const pauseScreen = document.getElementById('pause-screen');
            pauseScreen.textContent = locales[currentLang].paused;
            pauseScreen.style.display = 'flex';

            const textContentRaw = text;
            alert.textContent = textContentRaw + "! " + locales[currentLang].messages.adReady2;
            alert.style.display = 'block';
            adActive = true;
            setTimeout(() => alert.textContent = textContentRaw + "! " + locales[currentLang].messages.adReady1, 1000);
            setTimeout(() => {
                alert.style.display = 'none';
                adActive = false;
                lastAdTime = Date.now();
                showAd();
            }, 2000);
        }

        function launchFireworks() {
			const container = document.getElementById('fireworks-container');
			container.innerHTML = '';

			// Создаем основной фейерверк
			const fireworkFragment = document.importNode(yourSVGTemplate.content, true);
			const fireworkElement = fireworkFragment.firstElementChild;
			
			// Настройка стилей
			fireworkElement.style.position = 'fixed';
			fireworkElement.style.top = '50%';
			fireworkElement.style.left = '50%';
			fireworkElement.style.width = '150px';
			fireworkElement.style.height = '150px';
			fireworkElement.style.animation = 'explode 1s ease-out';

			// Добавляем частицы
			for(let i = 0; i < 8; i++) {
				const particle = document.importNode(yourSVGTemplate.content, true);
				const pElement = particle.firstElementChild;
				
				pElement.style.position = 'fixed';
				pElement.style.top = '50%';
				pElement.style.left = '50%';
				pElement.style.width = '80px';
				pElement.style.height = '80px';
				pElement.style.animation = `explode-particle ${1}s ease-out`;
				pElement.style.setProperty('--angle', `${i * 45}deg`);
				
				container.appendChild(pElement);
			}

			container.appendChild(fireworkElement);
			
			setTimeout(() => container.innerHTML = '', 1000);
		}

        function checkBestCombination() {
            const combinations = [
                { check: checkRoyalFlush, minCards: 5 },
                { check: checkStraightFlush, minCards: 5 },
                { check: checkFourOfAKind, minCards: 4 },
                { check: checkFullHouse, minCards: 5 },
                { check: checkFlush, minCards: 5 },
                { check: checkStraight, minCards: 5 },
                { check: checkThreeOfAKind, minCards: 3 },
                { check: checkTwoPair, minCards: 4 },
                { check: checkPair, minCards: 2 }
            ];

            for (const { check, minCards } of combinations) {
                if (cards.length >= minCards) {
                    const combo = check();
                    if (combo) {
                        const [indices, comboKey] = combo;
                        const baseBonus = getBaseBonus(comboKey);
                        const cardValues = indices.map(i => getCardValue(cards[i]));
                        const suitBonus = calculateSuitBonus(indices);
                        
                        const totalBonus = baseBonus + cardValues.reduce((a,b) => a + b, 0) + suitBonus;
                        score += totalBonus;
                        
                        highlightCards(indices);
                        const comboName = locales[currentLang].combinations[comboKey];
                        showComboAlert(`${comboName}! +${totalBonus.toLocaleString()} ${locales[currentLang].rewardedButton2}`);
                        showCardBonuses(indices, cardValues);
                        updateScore();
						yg.getLeaderboards().then(lb => {lb.setLeaderboardScore('leaderboardPokerNew', score);});
                        saveProgress();

                        if (comboKey === 'four' || comboKey === 'fullHouse' || comboKey === 'straightFlush' || comboKey === 'royalFlush') {
                            launchFireworks();
                        }

                        return;
                    }
                }
            }
        }

        function getBaseBonus(comboIndex) {
            const baseBonuses = {
                pair: 5,
                twoPairs: 10,
                three: 15,
                straight: 25,
                flush: 50,
                fullHouse: 100,
                four: 200,
                straightFlush: 500,
                royalFlush: 1000,
            };

            return baseBonuses[comboIndex] || 0;
        }

        function getCardValue(card) {
            return card.rank === 'A' ? 11 : 
                   ['J','Q','K'].includes(card.rank) ? 10 : 
                   parseInt(card.rank);
        }

        function calculateSuitBonus(indices) {
            return indices.reduce((acc, i) => {
                return acc + suitBonuses[cards[i].suit];
            }, 0);
        }

        function showCardBonuses(indices, cardValues) {
            indices.forEach((index, i) => {
                const bonusElement = document.getElementById(`bonus-${index}`);
                if(bonusElement) {
                    const total = cardValues[i] + suitBonuses[cards[index].suit];
                    bonusElement.textContent = `+${total}`;
                    bonusElement.style.display = 'block';
                }
            });
            
            setTimeout(() => {
                indices.forEach(index => {
                    const bonusElement = document.getElementById(`bonus-${index}`);
                    if(bonusElement) bonusElement.style.display = 'none';
                });
            }, 1500);
        }

        function highlightCards(indices) {
            indices.forEach(index => {
                const card = document.querySelector(`.card[data-index="${index}"]`);
                if (card) card.classList.add('highlight');
            });
            
            setTimeout(() => {
                indices.forEach(index => {
                    const card = document.querySelector(`.card[data-index="${index}"]`);
                    if (card) card.classList.remove('highlight');
                });
            }, 2500);
        }

        function checkRoyalFlush() {
            if (cards.length < 5) return null;
            const royalRanks = ['10', 'J', 'Q', 'K', 'A'];
            if (royalRanks.every(r => cards.map(c => c.rank).includes(r)) && 
                cards.every(c => c.suit === cards[0].suit)) {
                return [Array.from({length:5}, (_,i)=>i), 'royalFlush'];
            }
            return null;
        }

        function checkStraightFlush() {
            if (cards.length < 5) return null;
            const straight = checkStraight();
            const flush = checkFlush();
            if (straight && flush) {
                return [straight[0], 'straightFlush'];
            }
            return null;
        }

        function checkFourOfAKind() {
            if (cards.length < 4) return null;
            const counts = countRanks();
            const quadRank = Object.keys(counts).find(r => counts[r] >= 4);
            if (quadRank) {
                const indices = cards.map((c, i) => c.rank === quadRank ? i : -1).filter(i => i !== -1);
                return [indices, 'four'];
            }
            return null;
        }

        function checkFullHouse() {
            if (cards.length < 5) return null;
            const counts = countRanks();
            const three = Object.keys(counts).find(r => counts[r] >= 3);
            const pair = Object.keys(counts).find(r => counts[r] >= 2 && r !== three);
            if (three && pair) {
                const threeIndices = cards.map((c, i) => c.rank === three ? i : -1).filter(i => i !== -1);
                const pairIndices = cards.map((c, i) => c.rank === pair ? i : -1).filter(i => i !== -1);
                return [[...threeIndices, ...pairIndices], 'fullHouse'];
            }
            return null;
        }

        function checkFlush() {
            if (cards.every(c => c.suit === cards[0].suit)) {
                return [Array.from({length: cards.length}, (_,i)=>i), 'flush'];
            }
            return null;
        }

        function checkStraight() {
            const values = cards.map(c => 
                ['J','Q','K','A'].includes(c.rank) ? 
                ['J','Q','K','A'].indexOf(c.rank) + 11 : 
                parseInt(c.rank)
            ).sort((a, b) => a - b);

            let isStraight = true;
            for (let i = 1; i < values.length; i++) {
                if (values[i] - values[i-1] !== 1) {
                    isStraight = false;
                    break;
                }
            }

            if (!isStraight && values.includes(14)) {
                const wheel = [2,3,4,5,14];
                isStraight = wheel.every(v => values.includes(v));
            }

            if (isStraight) {
                return [Array.from({length: cards.length}, (_,i)=>i), 'straight'];
            }
            return null;
        }

        function checkThreeOfAKind() {
            const counts = countRanks();
            const threeRank = Object.keys(counts).find(r => counts[r] >= 3);
            if (threeRank) {
                const indices = cards.map((c, i) => c.rank === threeRank ? i : -1).filter(i => i !== -1);
                return [indices, 'three'];
            }
            return null;
        }

        function checkTwoPair() {
            const counts = countRanks();
            const pairs = Object.keys(counts).filter(r => counts[r] >= 2);
            if (pairs.length >= 2) {
                const indices = pairs.flatMap(r => 
                    cards.map((c, i) => c.rank === r ? i : -1).filter(i => i !== -1)
                );
                return [indices, 'twoPairs'];
            }
            return null;
        }

        function checkPair() {
            const counts = countRanks();
            const pairRank = Object.keys(counts).find(r => counts[r] >= 2);
            if (pairRank) {
                const indices = cards.map((c, i) => c.rank === pairRank ? i : -1).filter(i => i !== -1);
                return [indices, 'pair'];
            }
            return null;
        }

        function countRanks() {
            return cards.reduce((acc, c) => {
                acc[c.rank] = (acc[c.rank] || 0) + 1;
                return acc;
            }, {});
        }

        async function showRewardedVideo() {
            if (adActive) return;

            if (!yg || !rewardedAvailable) return;

            try {
                const rewarded = await yg.adv.showRewardedVideo({
                    callbacks: {
                        onOpen: () => console.log("Rewarded открыт"),
                        onClose: () => console.log("Rewarded закрыт"),
                        onRewarded: () => {
                            score += rewardedBonus;
                            updateScore();
                            saveProgress();
                            showComboAlert(`+${rewardedBonus} ` + locales[currentLang].rewardedButton2 + `!`);
                            rewardedAvailable = false;
                            updateRewardedButton();
                            setTimeout(() => {
                                rewardedAvailable = true;
                                updateRewardedButton();
                            }, 30000);
                        },
                        onError: (error) => console.error("Ошибка Rewarded:", error)
                    }
                });
            } catch (error) {
                console.error("Ошибка инициализации Rewarded:", error);
                //showComboAlert("Реклама временно недоступна");
            }
        }

        function updateScore() {
            document.getElementById('score').textContent =
                locales[currentLang].score + score.toLocaleString();
        }

        function updateUpgrades() {
            updateMaxCardsButton();
            updateSuitButtons();
            updateSuitBonusDisplays();
            updateRewardedButton();
        }

        function updateGameState() {
            updateCardsDisplay();
            updateScore();
            updateRewardedButton();
        }

        function updateRewardedButton() {
            const currentLevel = maxCards - 2;
            const nextLevelCost = maxCardCosts[currentLevel] || 10000000;
            rewardedBonus = maxCards > 7 ? Math.ceil(nextLevelCost * 0.020) : (maxCards > 5 ? Math.ceil(nextLevelCost * 0.025) : Math.ceil(nextLevelCost * 0.050));

            const rewardButton = document.getElementById('rewarded-video');
            rewardButton.textContent = locales[currentLang].rewardedButton1 + `${rewardedBonus}` + locales[currentLang].rewardedButton2;
            rewardButton.hidden = !yg || !rewardedAvailable || nextLevelCost === 0;
        }

        function updateCardsDisplay() {
            const container = document.getElementById('cards-container');
            container.innerHTML = cards.map((c, i) =>
                `<div class="card ${['♥', '♦'].includes(c.suit) ? 'red' : 'black'}" data-index="${i}">
                    <div class="card-content">
                        <span class="rank top">${c.rank}</span>
                        <span class="suit">${c.suit}</span>
                        <span class="rank bottom">${c.rank}</span>
                    </div>
                    <div class="card-bonus" id="bonus-${i}"></div>
                </div>`
            ).join('');
        }

        function updateMaxCardsButton() {
            const upgradeButton = document.getElementById('upgrade');
            const currentLevel = maxCards - 2;
            const maxLevel = maxCardCosts.length;
            const cost = maxCardCosts[currentLevel] || Infinity;

            if (currentLevel < maxLevel) {
                upgradeButton.innerHTML = `${locales[currentLang].maxCards}: ${currentLevel + 2}/${maxLevel + 2}<br>${locales[currentLang].upgradeButton}${cost.toLocaleString()})`;
                const progress = ((currentLevel) / maxLevel) * 100;
                upgradeButton.style.background = `linear-gradient(45deg, #00ff99 ${progress}%, #6666ff ${progress}%)`;
            } else {
                upgradeButton.textContent = locales[currentLang].maxLevel + " " + locales[currentLang].maxCards;
                upgradeButton.style.background = 'linear-gradient(45deg, #00ff99, #6666ff)';
            }
        }

        function upgradeMaxCards() {
            if (adActive) return;

            const currentLevel = maxCards - 2;
            if (currentLevel >= maxCardCosts.length) {
                showComboAlert(locales[currentLang].messages.maxCardsReached);
                return;
            }

            const cost = maxCardCosts[currentLevel];
            if (score >= cost) {
                score -= cost;
                maxCards++;

                const upgradeButton = document.getElementById('upgrade');
                upgradeButton.style.animation = 'gradientFill 0.5s forwards';
                setTimeout(() => {
                    upgradeButton.style.animation = '';
                    updateMaxCardsButton();
                }, 500);

                updateUpgrades();
                updateScore();
                saveProgress();
            } else {
                showComboAlert(locales[currentLang].messages.needPoints + `${cost.toLocaleString()}` + locales[currentLang].messages.points + ` ` + locales[currentLang].messages.pointsMaxCards + `!`);
            }
        }

        function upgradeSuit(suit) {
			if (adActive) return;
			
            const currentLevel = suitBonuses[suit];
            if (currentLevel >= suitUpgradeCosts.length) {
                showComboAlert(locales[currentLang].messages.maxSuitReached1 + `${suit}` + locales[currentLang].messages.maxSuitReached2);
                return;
            }

            const cost = suitUpgradeCosts[currentLevel];
            if (score >= cost) {
                score -= cost;
                suitBonuses[suit]++;
                
                updateSuitButtons();
                updateSuitBonusDisplays();
                updateScore();
                saveProgress();
                
                const btn = document.querySelector(`button.suit-upgrade[data-suit="${suit}"]`);
                if(btn) {
                    btn.style.animation = 'success 0.5s';
                    setTimeout(() => btn.style.animation = '', 500);
                }
            } else {
                showComboAlert(
                    locales[currentLang].messages.needPoints +
                    cost.toLocaleString() +
                    locales[currentLang].messages.points +
                    ` ${suit}!`
                );
            }
        }

        function updateSuitButtons() {
            suits.forEach(suit => {
                const btn = document.querySelector(`button.suit-upgrade[data-suit="${suit}"]`);
                const currentLevel = suitBonuses[suit];
                const maxLevel = suitUpgradeCosts.length;
                const cost = suitUpgradeCosts[currentLevel] || Infinity;

                if(currentLevel < suitUpgradeCosts.length) {
                    btn.textContent =
                        `${suit} ${locales[currentLang].suitUpgrade}${cost.toLocaleString()})`;
                    const progress = ((currentLevel) / maxLevel) * 100;
                } else {
                    btn.textContent = `${suit} ${locales[currentLang].maxLevel}`;
                }
            });
        }

        function updateSuitBonusDisplays() {
            suits.forEach(suit => {
                const element = document.getElementById(`bonus-${suit}`);
                if(element) {
                    element.textContent = `${suit} ` + locales[currentLang].level + `${suitBonuses[suit]}`;
                }
            });
        }

        async function loadProgress() {
            try {
                if (!yg) {
                    // Используем localStorage как fallback
                    score = parseInt(localStorage.getItem('score')) || 0;
                    maxCards = parseInt(localStorage.getItem('maxCards')) || 2;
                    const savedBonuses = localStorage.getItem('suitBonuses');
                    if (savedBonuses) {
                        const parsedBonuses = JSON.parse(savedBonuses);
                        suits.forEach(s => {
                            suitBonuses[s] = parsedBonuses[s] || 0;
                        });
                    }
                } else {
                    const storage = await yg.getStorage();
                    const savedData = await Promise.all([
                        storage.getItem('score'),
                        storage.getItem('maxCards'),
                        storage.getItem('suitBonuses')
                    ]);

                    score = savedData[0] ? parseInt(savedData[0]) : 0;
                    maxCards = savedData[1] ? parseInt(savedData[1]) : 2;
                    if(savedData[2]) {
                        const parsedBonuses = JSON.parse(savedData[2]);
                        suits.forEach(s => {
                            suitBonuses[s] = parsedBonuses[s] || 0;
                        });
                    }
                }

                updateMaxCardsButton();
                updateUpgrades();
                updateScore();
            } catch (error) {
                console.error("Ошибка загрузки:", error);
            }
        }

        async function saveProgress() {
            try {
                if (!yg) {
                    // Используем localStorage как fallback
                    localStorage.setItem('score', score.toString());
                    localStorage.setItem('maxCards', maxCards.toString());
                    localStorage.setItem('suitBonuses', JSON.stringify(suitBonuses));
                } else {
                    const storage = await yg.getStorage();
                    await storage.setItem('score', score.toString());
                    await storage.setItem('maxCards', maxCards.toString());
                    await storage.setItem('suitBonuses', JSON.stringify(suitBonuses));
                }
            } catch (error) {
                console.error("Ошибка сохранения прогресса:", error);
            }
        }

        function showAd() {
            document.getElementById('pause-screen').style.display = 'none';
            adReady = false;
			adActive = false;
            if (!yg) return;
            lastAdTime = Date.now();
            yg.adv.showFullscreenAdv({
                callbacks: {
                    onOpen: () => console.log("Реклама открыта"),
                    onClose: (wasShown) => console.log("Реклама закрыта", wasShown),
                    onError: (error) => console.error("Ошибка при показе рекламы", error)
                }
            });
        }

        init();
    </script>
</body>
</html>