<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Карточный Кликер</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 15px rgba(255,255,0,0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 25px rgba(255,255,0,0.8); }
            100% { transform: scale(1); box-shadow: 0 0 15px rgba(255,255,0,0.5); }
        }

        body {
            font-family: 'Press Start 2P', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a4d0a, #1a5d1a);
            color: white;
            min-height: 100vh;
            overflow: hidden;
        }

        body, button, #cards-container, .card, .loading-screen, .combo-alert, .combo-alert-ad {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;

            -webkit-touch-callout: none;
            user-drag: none;
            overscroll-behavior: contain;
        }

        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 150%;
            height: 150%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Cpath fill='%232a7d2a' fill-opacity='0.1' d='M0 0h20v20H0V0zm2 2h16v16H2V2zm6 6h8v8H8V8z'/%3E%3C/svg%3E") repeat;
            transform: rotate(-45deg);
            z-index: -1;
        }

        #game {
            position: relative;
            z-index: 1;
            margin: 100px 160px 20px;
        }

        .card {
            display: inline-block;
            width: 100px;
            height: 140px;
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            border-radius: 12px;
            margin: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            vertical-align: top;
            transition: transform 0.2s;
            font-size: 28px;
            position: relative;
            overflow: hidden;
        }

        .card.red {
            color: #c8102e;
            /*background: linear-gradient(135deg, #ffcccc, #ff6666);*/
            border: solid 1px #c8102e;
        }

        .card.black {
            color: #000000;
            /*background: linear-gradient(135deg, #333, #999);*/
            border: solid 1px #000000;
        }

        .card-content {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .rank {
            font-size: 20px;
            position: absolute;
        }

        .rank.top { top: 5px; left: 5px; }
        .rank.bottom { bottom: 5px; right: 5px; transform: rotate(180deg); }
        .suit { font-size: 40px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }

        .card-bonus {
            position: absolute;
            bottom: 5px;
            width: 100%;
            font-size: 14px;
            color: yellow;
            text-shadow: 1px 1px 2px black;
            display: none;
        }

        .card.highlight {
            animation: pulse 0.5s;
            transform: scale(1.1);
            border: 3px solid gold;
        }

        #click-button {
            padding: 20px 40px;
            font-family: 'Press Start 2P';
            font-size: 24px;
            background: linear-gradient(45deg, #ffcc00, #ff9900);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255,153,0,0.5);
            transition: all 0.3s;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 20px;
            position: relative;
            overflow: hidden;
        }

        #click-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,153,0,0.7);
        }

        #click-button:active {
            transform: translateY(0);
        }

        #click-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent 25%, rgba(255,255,255,0.3), transparent 75%);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
		
		@keyframes success {
            0% { background-color: #66ff66; }
            100% { background-color: inherit; }
        }

        #score {
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 20px;
        }

        #upgrade {
            white-space: normal;

            font-family: 'Press Start 2P', sans-serif;
            position: fixed;
            padding: 12px 25px;
            background: linear-gradient(45deg, #00ff99, #00cc66);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 3px 8px rgba(0,204,102,0.5);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            margin: 5px 0;
            display: block;

            left: 50%;
            transform: translateX(-50%);
            top: 5px;
            width: 360px;
            z-index: 10;
        }

        #suit-upgrades {
            font-family: 'Press Start 2P', sans-serif;
            position: fixed;
            top: 5px;
            right: 5px;
            text-align: right;
        }

        .suit-upgrade {
            font-family: 'Press Start 2P', sans-serif;
            display: block;
            width: 160px;
            padding: 8px 15px;
            background: linear-gradient(45deg, #6666ff, #4d4dff);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            margin: 5px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .suit-bonus {
            margin-top: 5px;
            font-size: 14px;
            color: #ccc;
        }

		#rewarded-video {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 12px 25px;
            background: linear-gradient(45deg, #ff6666, #cc0000);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 3px 8px rgba(204,0,0,0.5);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .combo-alert {
            margin: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #ffff66, #ffcc00);
            color: #333;
            border-radius: 10px;
            display: none;
            font-size: 20px;
            text-shadow: 1px 1px 2px white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            animation: fadeInOut 2s; /* Анимация появления и исчезновения */
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .combo-alert-ad {
            position: fixed;
            top: 5rem;
            margin: 20px auto;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px;
            background: linear-gradient(45deg, #ffff66, #ffcc00);
            color: #333;
            border-radius: 10px;
            display: none;
            font-size: 20px;
            text-shadow: 1px 1px 2px white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1001;
        }

        .loading-screen, .pause-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(50, 50, 50, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .loading-screen {
            z-index: 1002;
        }

        .pause-screen {
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: none;
        }

        #fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10000;
        }

        .firework {
            position: absolute;
            animation: flyUp 1s ease-out;
            opacity: 0;
        }

        @keyframes flyUp {
            0% { opacity: 1; transform: translateY(100vh); }
            80% { opacity: 1; transform: translateY(-50px); }
            100% { opacity: 0; transform: translateY(-150px); }
        }

        /* Мобильная адаптация */
        @media (max-width: 960px) {
            body {
                margin: 0 auto;
                padding: 0 10px 0 0;
            }

			body::before {
				width: 100%;
				height: 100%;
			}

            #game {
				width: calc(100% - 115px);
				margin: 65px 0;
            }

            #cards-container {
                white-space: nowrap;
                overflow-x: auto;
                padding-bottom: 0;
            }

            .card {
                max-width: 60px;
                height: 85px;
                font-size: 16px;
                margin: 8px 5px;
            }

			.suit {
				transform: translate(-50%, -60%);
			}

            #click-button {
                padding: 12px 24px;
                font-size: 16px;
                margin: 10px auto;
                display: block;
                width: 280px;
            }

            #upgrade {
				font-size: 14px;
                left: calc(50% - 70px);
				z-index: 10;
            }

            #suit-upgrades {
                position: fixed;
                top: 2px;
                right: 5px;
                text-align: right;
                display: flex;
                flex-direction: column;
                align-items: flex-end;
                gap: 5px;
                z-index: 10;
            }

            .suit-upgrade {
                width: 115px;
                padding: 0 8px 4px;
                font-size: 12px;
				margin-top: 0;
                background: linear-gradient(45deg, #00ff99, #6666ff);
            }

            .suit-bonus {
                font-size: 10px;
                margin-top: 3px;
            }

            #rewarded-video {
                right: 10px;
                left: unset;
                padding: 8px 15px;
                font-size: 14px;
				max-width: 120px;
            }

            /*.combo-alert {
				position: fixed;
				top: 100px;
				left: 40%;
				transform: translateX(-50%);
				width: 60vw;
                font-size: 16px;
                padding: 10px;
                z-index: 999;
            }*/

            .combo-alert-ad {
				width: 65vw;
                font-size: 16px;
                padding: 10px;
            }

            .loading-screen, .pause-screen {
                font-size: 24px;
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <div id="game">
        <div id="cards-container"></div>
        <div id="score">Очки: 0</div>
        <div id="combo-alert" class="combo-alert"></div>
        <button id="click-button" onclick="generateCard()">Клик!</button>
    </div>

    <div id="fireworks-container"></div>

    <template id="firework-template">
        <svg height="100px" width="100px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
             viewBox="0 0 466.078 466.078" xml:space="preserve">
        <g>
            <path style="fill:#FFEBAF;" d="M253.038,466.071c0-0.02,0-0.041,0-0.061c-0.045-3.903-2.553-194.286-61.342-298.615l-38.571-20.277
                l-13.796,7.252c20.998,28.903,88.661,132.3,111.184,291.94c2.159,12.192,2.518,19.631,2.524,19.756L253.038,466.071z"/>
            <polygon style="fill:#FFEBAF;" points="253.039,466.078 253.039,466.068 253.039,466.074 	"/>
            <path style="fill:#FFEBAF;" d="M348.877,251.534l-11.924-6.268l-41.929,22.043c-22.932,58.088-33.483,118.543-38.238,157.302
                c-2.438,24.802-3.675,40.526-3.745,41.421c-0.001,0.017-0.002,0.047-0.002,0.047C265.244,347.032,338.056,263.379,348.877,251.534z
                "/>
            <path style="fill:#FFE696;" d="M250.514,446.31c-6.758-38.154-31.209-122.855-117.977-175.805l-5.371,5.235l2.322,13.538
                c39.679,24.478,108.482,79.968,123.55,176.801l-0.001-0.012C253.032,465.94,252.673,458.502,250.514,446.31z"/>
            <path style="fill:#FFE696;" d="M321.448,88.994l-8.325-4.377l-20.167,10.602c-7.096,25.942-13.113,56.945-18.154,90.081
                l17.522-2.548C300.655,145.148,310.351,111.785,321.448,88.994z"/>
            <path style="fill:#FFE696;" d="M287.511,205.668l-13.749-13.403c-14.733,100.384-20.719,218.137-20.723,273.745
                c0,0.02,0,0.041,0,0.061v0.007l0-0.004l0-0.005c0-0.004,0.001-0.016,0.003-0.037c0.07-0.895,1.307-16.619,3.745-41.421
                C261.816,373.438,271.957,283.629,287.511,205.668z"/>
            <path style="fill:#FFE178;" d="M191.696,167.395l19.074,10.027l-11.008-64.188l46.637-45.461l-64.449-9.367L153.125,0
                l-28.824,58.406l-64.453,9.367l46.637,45.461l-11.008,64.188l43.853-23.053l13.796-7.252L191.696,167.395z M94.23,78.945
                l40.695-5.914l18.199-36.875l18.199,36.875l40.691,5.914l-29.449,28.695l6.953,40.531l-36.395-19.133l-36.398,19.133l6.953-40.531
                L94.23,78.945z"/>
            <path style="fill:#FFE178;" d="M302.316,220.102l-8.176,47.672l0.884-0.465l41.929-22.043l11.924,6.268l30.892,16.24l-8.176-47.672
                l34.637-33.766l-47.867-6.961L336.953,136l-21.406,43.375l-23.223,3.377l-17.522,2.548l-7.123,1.036l6.082,5.929l13.749,13.403
                L302.316,220.102z M326.172,194l10.781-21.844L347.738,194l24.109,3.508l-17.449,17l4.121,24.016l-21.566-11.336l-21.563,11.336
                l4.121-24.016l-17.449-17L326.172,194z"/>
            <polygon style="fill:#FFD237;" points="132.537,270.504 149.208,254.254 118.746,249.827 105.124,222.224 91.501,249.827
                61.039,254.254 83.081,275.74 77.878,306.078 105.124,291.754 132.369,306.078 129.488,289.277 127.166,275.74 	"/>
            <polygon style="fill:#FFD237;" points="321.448,88.994 345.314,101.54 339.166,65.696 365.208,40.311 329.219,35.082 313.124,2.47
                297.029,35.082 261.039,40.311 287.081,65.696 280.934,101.54 292.957,95.219 313.124,84.617 	"/>
            <polygon style="fill:#FFD237;" points="251.488,128.593 244.3,114.029 237.112,128.593 221.039,130.929 232.67,142.266
                229.924,158.274 244.3,150.716 258.676,158.274 255.931,142.266 267.561,130.929 	"/>
            <polygon style="fill:#FFD237;" points="366.157,322.319 358.969,307.755 351.781,322.319 335.708,324.655 347.339,335.992
                344.593,352 358.969,344.442 373.346,352 370.6,335.992 382.23,324.655 	"/>
        </g>
        </svg>
    </template>

    <div id="combo-alert-ad" class="combo-alert-ad"></div>

    <div id="loading-screen" class="loading-screen">Загрузка...</div>
    <div id="pause-screen" class="pause-screen">Пауза</div>

    <button id="upgrade" onclick="upgradeMaxCards()">Улучшить (250)</button>

    <div id="suit-upgrades">
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♥" onclick="upgradeSuit('♥')">♥ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♥">♥ Уровень: 0</div>
        </div>
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♠" onclick="upgradeSuit('♠')">♠ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♠">♠ Уровень: 0</div>
        </div>
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♦" onclick="upgradeSuit('♦')">♦ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♦">♦ Уровень: 0</div>
        </div>
        <div class="suit-upgrade-container">
            <button class="suit-upgrade" data-suit="♣" onclick="upgradeSuit('♣')">♣ Усилить (50)</button>
            <div class="suit-bonus" id="bonus-♣">♣ Уровень: 0</div>
        </div>
    </div>

    <button id="rewarded-video" onclick="showRewardedVideo()">Посмотреть видео, получить награду</button>

    <script src="https://yandex.ru/games/sdk/v2"></script>

    <script>
        const locales = {
            en: {
                level: "Level: ",
                score: "Score: ",
                clickButton: "Click!",
                maxCards: "cards",
                upgradeButton: "Upgrade (",
                suitUpgrade: "Enhance (",
                maxLevel: "MAX",
                rewardedButton1: "Watch video, get ",
                rewardedButton2: " points",
                loading: "Loading...",
                paused: "Paused",
                combinations: {
                    pair: "Pair",
                    twoPairs: "Two Pairs",
                    three: "Three of a Kind",
                    straight: "Straight",
                    flush: "Flush",
                    fullHouse: "Full House",
                    four: "Four of a Kind",
                    straightFlush: "Straight Flush",
                    royalFlush: "Royal Flush"
                },
                messages: {
                    needPoints: "Need ",
                    points: " points for upgrading",
                    pointsMaxCards: "cards maximum",
                    maxCardsReached: "Max cards reached!",
                    maxSuitReached1: "Suit ",
                    maxSuitReached2: " already at max level!",
                    adReady2: "Ad ready in 2...",
                    adReady1: "Ad ready in 1..."
                },
                clickMessages: ["Click-click!", "More!", "Press!", "Press faster!", "Well done!", "It works!", "Go ahead!", "Fantastic!", "Power!", "Come on!", "You can do it!", "You can do it", "Believe in yourself!", "Go for it!", "Don't stop!", "Keep going", "Bravo :)", "Awesome", "Professional!", "Excellent", "Unique", "Keep it up", "Top class!", "Amazing", "Masterful!"]
            },
            ru: {
                level: "Уровень: ",
                score: "Очки: ",
                clickButton: "Клик!",
                maxCards: "карт",
                upgradeButton: "Улучшить (",
                suitUpgrade: "Усилить (",
                maxLevel: "МАКСИМУМ",
                rewardedButton1: "Посмотреть видео, получить ",
                rewardedButton2: " очков",
                loading: "Загрузка...",
                paused: "Пауза",
                combinations: {
                    pair: "Пара",
                    twoPairs: "Две пары",
                    three: "Сет",
                    straight: "Стрит",
                    flush: "Флеш",
                    fullHouse: "Фулл-хаус",
                    four: "Каре",
                    straightFlush: "Стрит-флеш",
                    royalFlush: "Роял-флеш"
                },
                messages: {
                    needPoints: "Нужно ",
                    points: " очков для улучшения",
                    pointsMaxCards: "максимума карт",
                    maxCardsReached: "Достигнут максимум карт!",
                    maxSuitReached1: "Масть ",
                    maxSuitReached2: " уже усилена до максимального уровня!",
                    adReady2: "Реклама через 2 секунды...",
                    adReady1: "Реклама через 1 секунду..."
                },
                clickMessages: ["Клик-клик!", "Еще!", "Жми!", "Жми быстрее!", "Молодец!", "Получается!", "Вперед!", "Фантастика!", "Мощь!", "Давай!", "Ты сможешь!", "Ты справишься", "Верь в себя!", "Действуй!", "Не останавливайся!", "Продолжай", "Браво :)", "Бесподобно", "Профессионально!", "Великолепно", "Неповторимо", "Так держать", "Высший класс!", "Изумительно", "Мастерски!"]
            }
        };

        let currentLang = 'ru'; // По умолчанию

        let score = 0;
        let maxCards = 2;
        let cards = [];
        const suits = ['♥', '♠', '♦', '♣'];
        const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];

        let yg;
		let lb;

        let suitBonuses = {'♥':0, '♠':0, '♦':0, '♣':0};

		const maxCardCosts =        [500, 2500, 12500, 125000, 750000, 1800000, 7000000, 9999999];
        const suitUpgradeCosts =    [100, 500, 2500, 7500, 12500, 25000, 50000, 100000, 125000, 175000, 350000, 500000, 600000, 750000];

        let rewardedBonus = 0;
        let rewardedAvailable = true;

        let comboTimeout = null;

        let adCooldown = 65000;
        let lastAdTime = 0;
        let adReady = false;
        let adActive = false;

        const yourSVGTemplate = document.getElementById('firework-template');

        document.addEventListener('keydown', (event) => {
            // Проверяем, доступен ли SDK Яндекса
            const isYandexDraft = false/*!yg || typeof yg == "undefined" || (yg && yg.environment?.draft == true)*/;

            const currentLevel = maxCards - 2;
            const nextLevelCost = maxCardCosts[currentLevel] || 10000000;

            // Сброс очков по клавише R
            if (event.key.toLowerCase() === 'r' && isYandexDraft) {
                score = 0;
                updateScore();
                saveProgress();
                showComboAlert(locales[currentLang].score + " reset to 0!");
            }
            if (event.key.toLowerCase() === 't' && isYandexDraft) {
                score += nextLevelCost;
                updateScore();
                saveProgress();
                showComboAlert(locales[currentLang].score + " reset to 0!");
            }

            // Увеличение максимума карт по NumPad +
            if (event.key === '+' && event.location === KeyboardEvent.DOM_KEY_LOCATION_NUMPAD && isYandexDraft) {
                if (maxCards < maxCardCosts.length + 2) {
                    maxCards++;
                    updateMaxCardsButton();
                    updateScore();
                    saveProgress();
                    showComboAlert(`${locales[currentLang].maxCards} ${maxCards}/${maxCardCosts.length + 2}`);
                }
            }

            // Уменьшение максимума карт по NumPad -
            if (event.key === '-' && event.location === KeyboardEvent.DOM_KEY_LOCATION_NUMPAD && isYandexDraft) {
                if (maxCards > 2) {
                    maxCards--;
                    updateMaxCardsButton();
                    updateScore();
                    saveProgress();
                    showComboAlert(`${locales[currentLang].maxCards} ${maxCards}/${maxCardCosts.length + 2}`);
                }
            }
        });

        async function init() {
            document.getElementById('loading-screen').textContent = locales[currentLang].loading;
            document.getElementById('loading-screen').style.display = 'flex';

            try {
                yg = await YaGames.init();
                yg.getLeaderboards().then(_lb => lb = _lb);

                currentLang = yg.environment.i18n?.lang?.startsWith('en') ? 'en' : 'ru';
                applyTranslations();

                yg.features.LoadingAPI?.ready();
                document.getElementById('loading-screen').style.display = 'none';

                await loadProgress();
            } catch (error) {
                console.warn("Yandex SDK unavailable or failed to initialize:", error);
                // Если SDK недоступен, все равно запускаем игру
                currentLang = 'ru'; // Устанавливаем язык по умолчанию
                applyTranslations();
                document.getElementById('loading-screen').style.display = 'none';
            }

            updateUpgrades();
            updateGameState();
            if (yg) showAd();
        }

        function applyTranslations() {
            document.getElementById('click-button').textContent = locales[currentLang].clickButton;
            document.getElementById('rewarded-video').textContent = locales[currentLang].rewardedButton1 + `25` + locales[currentLang].rewardedButton2;
            document.querySelector('title').textContent = currentLang === 'ru'
                ? 'Карточный Кликер'
                : 'Card Clicker';

            updateScore();
            updateUpgrades();
        }

        function generateCard() {
            if (adActive) return;
            const btn = document.getElementById('click-button');
            btn.style.animation = 'pulse 0.3s';
            setTimeout(() => btn.style.animation = '', 300);
            btn.textContent = locales[currentLang].clickMessages[Math.floor(Math.random() * locales[currentLang].clickMessages.length)];

            // Генерируем список доступных карт (без дубликатов)
            const availableCards = [];
            for (const suit of suits) {
                for (const rank of ranks) {
                    if (!cards.some(card => card.suit === suit && card.rank === rank)) {
                        availableCards.push({ suit, rank });
                    }
                }
            }

            if (availableCards.length === 0) {
                showComboAlert("Нет доступных карт для генерации!");
                return;
            }

            // Выбираем случайную доступную карту
            const randomIndex = Math.floor(Math.random() * availableCards.length);
            const newCard = availableCards[randomIndex];

            // Добавляем новую карту и удаляем старую, если превышен лимит
            cards.push(newCard);
            if (cards.length > maxCards) cards.shift();

            // Обновляем интерфейс и логику
            updateCardsDisplay();
            updateUpgrades();
            checkBestCombination();
            score++;
            updateScore();
            saveProgress();
            const currentTime = Date.now();
            if (currentTime - lastAdTime > adCooldown) {
                adReady = true;
            }
        }

        function showComboAlert(text) {
            if (adReady) {
                adReady = false;
                showComboAlertAd(text);
                return;
            }

            const alert = document.getElementById('combo-alert');

            if(comboTimeout) {
                clearTimeout(comboTimeout);
                comboTimeout = null;
            }

            alert.textContent = text;
            alert.style.display = 'block';

            comboTimeout = setTimeout(() => {
                alert.style.display = 'none';
                comboTimeout = null;
            }, 2000);
        }

        function showComboAlertAd(text) {
            const alert = document.getElementById('combo-alert-ad');
            const pauseScreen = document.getElementById('pause-screen');
            pauseScreen.textContent = locales[currentLang].paused;
            pauseScreen.style.display = 'flex';

            const textContentRaw = text;
            alert.textContent = textContentRaw + "! " + locales[currentLang].messages.adReady2;
            alert.style.display = 'block';
            adActive = true;
            setTimeout(() => alert.textContent = textContentRaw + "! " + locales[currentLang].messages.adReady1, 1000);
            setTimeout(() => {
                alert.style.display = 'none';
                adActive = false;
                lastAdTime = Date.now();
                showAd();
            }, 2000);
        }

        function launchFireworks() {
            const container = document.getElementById('fireworks-container');
            container.innerHTML = ''; // Очистить предыдущие фейерверки

            // Импортируем SVG из шаблона
            const fireworkFragment1 = document.importNode(yourSVGTemplate.content, true);
            const fireworkElement1 = fireworkFragment1.firstElementChild; // Берем первый элемент (SVG)

            // Настройка позиционирования
            fireworkElement1.style.position = 'absolute'; // Важно!
            fireworkElement1.style.left = 0;

            // Добавляем анимацию
            fireworkElement1.style.animation = 'flyUp 1s ease-out';

            container.appendChild(fireworkElement1);

            // Импортируем SVG из шаблона
            const fireworkFragment2 = document.importNode(yourSVGTemplate.content, true);
            const fireworkElement2 = fireworkFragment2.firstElementChild; // Берем первый элемент (SVG)

            // Настройка позиционирования
            fireworkElement2.style.position = 'absolute'; // Важно!
            fireworkElement2.style.left = (0.9 * window.innerWidth) + 'px';

            // Добавляем анимацию
            fireworkElement2.style.animation = 'flyUp 1s ease-out';

            container.appendChild(fireworkElement2);

            // Удалить фейерверки после завершения
            setTimeout(() => container.innerHTML = '', 1000);
        }

        function checkBestCombination() {
            const combinations = [
                { check: checkRoyalFlush, minCards: 5 },
                { check: checkStraightFlush, minCards: 5 },
                { check: checkFourOfAKind, minCards: 4 },
                { check: checkFullHouse, minCards: 5 },
                { check: checkFlush, minCards: 5 },
                { check: checkStraight, minCards: 5 },
                { check: checkThreeOfAKind, minCards: 3 },
                { check: checkTwoPair, minCards: 4 },
                { check: checkPair, minCards: 2 }
            ];

            for (const { check, minCards } of combinations) {
                if (cards.length >= minCards) {
                    const combo = check();
                    if (combo) {
                        const [indices, comboKey] = combo;
                        const baseBonus = getBaseBonus(comboKey);
                        const cardValues = indices.map(i => getCardValue(cards[i]));
                        const suitBonus = calculateSuitBonus(indices);
                        
                        const totalBonus = baseBonus + cardValues.reduce((a,b) => a + b, 0) + suitBonus;
                        score += totalBonus;
                        
                        highlightCards(indices);
                        const comboName = locales[currentLang].combinations[comboKey];
                        showComboAlert(`${comboName}! +${totalBonus.toLocaleString()} ${locales[currentLang].rewardedButton2}`);
                        showCardBonuses(indices, cardValues);
                        updateScore();
						yg.getLeaderboards().then(lb => {lb.setLeaderboardScore('leaderboardPokerNew', score);});
                        saveProgress();

                        if (comboKey === 'four' || comboKey === 'fullHouse' || comboKey === 'straightFlush' || comboKey === 'royalFlush') {
                            launchFireworks();
                        }

                        return;
                    }
                }
            }
        }

        function getBaseBonus(comboIndex) {
            const baseBonuses = {
                pair: 5,
                twoPairs: 10,
                three: 15,
                straight: 25,
                flush: 50,
                fullHouse: 100,
                four: 200,
                straightFlush: 500,
                royalFlush: 1000,
            };

            return baseBonuses[comboIndex] || 0;
        }

        function getCardValue(card) {
            return card.rank === 'A' ? 11 : 
                   ['J','Q','K'].includes(card.rank) ? 10 : 
                   parseInt(card.rank);
        }

        function calculateSuitBonus(indices) {
            return indices.reduce((acc, i) => {
                return acc + suitBonuses[cards[i].suit];
            }, 0);
        }

        function showCardBonuses(indices, cardValues) {
            indices.forEach((index, i) => {
                const bonusElement = document.getElementById(`bonus-${index}`);
                if(bonusElement) {
                    const total = cardValues[i] + suitBonuses[cards[index].suit];
                    bonusElement.textContent = `+${total}`;
                    bonusElement.style.display = 'block';
                }
            });
            
            setTimeout(() => {
                indices.forEach(index => {
                    const bonusElement = document.getElementById(`bonus-${index}`);
                    if(bonusElement) bonusElement.style.display = 'none';
                });
            }, 1500);
        }

        function highlightCards(indices) {
            indices.forEach(index => {
                const card = document.querySelector(`.card[data-index="${index}"]`);
                if (card) card.classList.add('highlight');
            });
            
            setTimeout(() => {
                indices.forEach(index => {
                    const card = document.querySelector(`.card[data-index="${index}"]`);
                    if (card) card.classList.remove('highlight');
                });
            }, 2500);
        }

        function checkRoyalFlush() {
            if (cards.length < 5) return null;
            const royalRanks = ['10', 'J', 'Q', 'K', 'A'];
            if (royalRanks.every(r => cards.map(c => c.rank).includes(r)) && 
                cards.every(c => c.suit === cards[0].suit)) {
                return [Array.from({length:5}, (_,i)=>i), 'royalFlush'];
            }
            return null;
        }

        function checkStraightFlush() {
            if (cards.length < 5) return null;
            const straight = checkStraight();
            const flush = checkFlush();
            if (straight && flush) {
                return [straight[0], 'straightFlush'];
            }
            return null;
        }

        function checkFourOfAKind() {
            if (cards.length < 4) return null;
            const counts = countRanks();
            const quadRank = Object.keys(counts).find(r => counts[r] >= 4);
            if (quadRank) {
                const indices = cards.map((c, i) => c.rank === quadRank ? i : -1).filter(i => i !== -1);
                return [indices, 'four'];
            }
            return null;
        }

        function checkFullHouse() {
            if (cards.length < 5) return null;
            const counts = countRanks();
            const three = Object.keys(counts).find(r => counts[r] >= 3);
            const pair = Object.keys(counts).find(r => counts[r] >= 2 && r !== three);
            if (three && pair) {
                const threeIndices = cards.map((c, i) => c.rank === three ? i : -1).filter(i => i !== -1);
                const pairIndices = cards.map((c, i) => c.rank === pair ? i : -1).filter(i => i !== -1);
                return [[...threeIndices, ...pairIndices], 'fullHouse'];
            }
            return null;
        }

        function checkFlush() {
            if (cards.every(c => c.suit === cards[0].suit)) {
                return [Array.from({length: cards.length}, (_,i)=>i), 'flush'];
            }
            return null;
        }

        function checkStraight() {
            const values = cards.map(c => 
                ['J','Q','K','A'].includes(c.rank) ? 
                ['J','Q','K','A'].indexOf(c.rank) + 11 : 
                parseInt(c.rank)
            ).sort((a, b) => a - b);

            let isStraight = true;
            for (let i = 1; i < values.length; i++) {
                if (values[i] - values[i-1] !== 1) {
                    isStraight = false;
                    break;
                }
            }

            if (!isStraight && values.includes(14)) {
                const wheel = [2,3,4,5,14];
                isStraight = wheel.every(v => values.includes(v));
            }

            if (isStraight) {
                return [Array.from({length: cards.length}, (_,i)=>i), 'straight'];
            }
            return null;
        }

        function checkThreeOfAKind() {
            const counts = countRanks();
            const threeRank = Object.keys(counts).find(r => counts[r] >= 3);
            if (threeRank) {
                const indices = cards.map((c, i) => c.rank === threeRank ? i : -1).filter(i => i !== -1);
                return [indices, 'three'];
            }
            return null;
        }

        function checkTwoPair() {
            const counts = countRanks();
            const pairs = Object.keys(counts).filter(r => counts[r] >= 2);
            if (pairs.length >= 2) {
                const indices = pairs.flatMap(r => 
                    cards.map((c, i) => c.rank === r ? i : -1).filter(i => i !== -1)
                );
                return [indices, 'twoPairs'];
            }
            return null;
        }

        function checkPair() {
            const counts = countRanks();
            const pairRank = Object.keys(counts).find(r => counts[r] >= 2);
            if (pairRank) {
                const indices = cards.map((c, i) => c.rank === pairRank ? i : -1).filter(i => i !== -1);
                return [indices, 'pair'];
            }
            return null;
        }

        function countRanks() {
            return cards.reduce((acc, c) => {
                acc[c.rank] = (acc[c.rank] || 0) + 1;
                return acc;
            }, {});
        }

        async function showRewardedVideo() {
            if (adActive) return;

            if (!yg || !rewardedAvailable) return;

            try {
                const rewarded = await yg.adv.showRewardedVideo({
                    callbacks: {
                        onOpen: () => console.log("Rewarded открыт"),
                        onClose: () => console.log("Rewarded закрыт"),
                        onRewarded: () => {
                            score += rewardedBonus;
                            updateScore();
                            saveProgress();
                            showComboAlert(`+${rewardedBonus} ` + locales[currentLang].rewardedButton2 + `!`);
                            rewardedAvailable = false;
                            updateRewardedButton();
                            setTimeout(() => {
                                rewardedAvailable = true;
                                updateRewardedButton();
                            }, 30000);
                        },
                        onError: (error) => console.error("Ошибка Rewarded:", error)
                    }
                });
            } catch (error) {
                console.error("Ошибка инициализации Rewarded:", error);
                //showComboAlert("Реклама временно недоступна");
            }
        }

        function updateScore() {
            document.getElementById('score').textContent =
                locales[currentLang].score + score.toLocaleString();
        }

        function updateUpgrades() {
            updateMaxCardsButton();
            updateSuitButtons();
            updateSuitBonusDisplays();
            updateRewardedButton();
        }

        function updateGameState() {
            updateCardsDisplay();
            updateScore();
            updateRewardedButton();
        }

        function updateRewardedButton() {
            const currentLevel = maxCards - 2;
            const nextLevelCost = maxCardCosts[currentLevel] || 10000000;
            rewardedBonus = maxCards > 5 ? Math.ceil(nextLevelCost * 0.05) : Math.ceil(nextLevelCost * 0.1);

            const rewardButton = document.getElementById('rewarded-video');
            rewardButton.textContent = locales[currentLang].rewardedButton1 + `${rewardedBonus}` + locales[currentLang].rewardedButton2;
            rewardButton.hidden = !yg || !rewardedAvailable || nextLevelCost === 0;
        }

        function updateCardsDisplay() {
            const container = document.getElementById('cards-container');
            container.innerHTML = cards.map((c, i) =>
                `<div class="card ${['♥', '♦'].includes(c.suit) ? 'red' : 'black'}" data-index="${i}">
                    <div class="card-content">
                        <span class="rank top">${c.rank}</span>
                        <span class="suit">${c.suit}</span>
                        <span class="rank bottom">${c.rank}</span>
                    </div>
                    <div class="card-bonus" id="bonus-${i}"></div>
                </div>`
            ).join('');
        }

        function updateMaxCardsButton() {
            const upgradeButton = document.getElementById('upgrade');
            const currentLevel = maxCards - 2;
            const maxLevel = maxCardCosts.length;
            const cost = maxCardCosts[currentLevel] || Infinity;

            if (currentLevel < maxLevel) {
                upgradeButton.innerHTML = `${locales[currentLang].maxCards}: ${currentLevel + 2}/${maxLevel + 2}<br>${locales[currentLang].upgradeButton}${cost.toLocaleString()})`;
                const progress = ((currentLevel) / maxLevel) * 100;
                upgradeButton.style.background = `linear-gradient(45deg, #00ff99 ${progress}%, #6666ff ${progress}%)`;
            } else {
                upgradeButton.textContent = locales[currentLang].maxLevel + " " + locales[currentLang].maxCards;
                upgradeButton.style.background = 'linear-gradient(45deg, #00ff99, #6666ff)';
            }
        }

        function upgradeMaxCards() {
            if (adActive) return;

            const currentLevel = maxCards - 2;
            if (currentLevel >= maxCardCosts.length) {
                showComboAlert(locales[currentLang].messages.maxCardsReached);
                return;
            }

            const cost = maxCardCosts[currentLevel];
            if (score >= cost) {
                score -= cost;
                maxCards++;

                const upgradeButton = document.getElementById('upgrade');
                upgradeButton.style.animation = 'gradientFill 0.5s forwards';
                setTimeout(() => {
                    upgradeButton.style.animation = '';
                    updateMaxCardsButton();
                }, 500);

                updateUpgrades();
                updateScore();
                saveProgress();
            } else {
                showComboAlert(locales[currentLang].messages.needPoints + `${cost.toLocaleString()}` + locales[currentLang].messages.points + ` ` + locales[currentLang].messages.pointsMaxCards + `!`);
            }
        }

        function upgradeSuit(suit) {
			if (adActive) return;
			
            const currentLevel = suitBonuses[suit];
            if (currentLevel >= suitUpgradeCosts.length) {
                showComboAlert(locales[currentLang].messages.maxSuitReached1 + `${suit}` + locales[currentLang].messages.maxSuitReached2);
                return;
            }

            const cost = suitUpgradeCosts[currentLevel];
            if (score >= cost) {
                score -= cost;
                suitBonuses[suit]++;
                
                updateSuitButtons();
                updateSuitBonusDisplays();
                updateScore();
                saveProgress();
                
                const btn = document.querySelector(`button.suit-upgrade[data-suit="${suit}"]`);
                if(btn) {
                    btn.style.animation = 'success 0.5s';
                    setTimeout(() => btn.style.animation = '', 500);
                }
            } else {
                showComboAlert(
                    locales[currentLang].messages.needPoints +
                    cost.toLocaleString() +
                    locales[currentLang].messages.points +
                    ` ${suit}!`
                );
            }
        }

        function updateSuitButtons() {
            suits.forEach(suit => {
                const btn = document.querySelector(`button.suit-upgrade[data-suit="${suit}"]`);
                const currentLevel = suitBonuses[suit];
                const maxLevel = suitUpgradeCosts.length;
                const cost = suitUpgradeCosts[currentLevel] || Infinity;

                if(currentLevel < suitUpgradeCosts.length) {
                    btn.textContent =
                        `${suit} ${locales[currentLang].suitUpgrade}${cost.toLocaleString()})`;
                    const progress = ((currentLevel) / maxLevel) * 100;
                } else {
                    btn.textContent = `${suit} ${locales[currentLang].maxLevel}`;
                }
            });
        }

        function updateSuitBonusDisplays() {
            suits.forEach(suit => {
                const element = document.getElementById(`bonus-${suit}`);
                if(element) {
                    element.textContent = `${suit} ` + locales[currentLang].level + `${suitBonuses[suit]}`;
                }
            });
        }

        async function loadProgress() {
            try {
                if (!yg) {
                    // Используем localStorage как fallback
                    score = parseInt(localStorage.getItem('score')) || 0;
                    maxCards = parseInt(localStorage.getItem('maxCards')) || 2;
                    const savedBonuses = localStorage.getItem('suitBonuses');
                    if (savedBonuses) {
                        const parsedBonuses = JSON.parse(savedBonuses);
                        suits.forEach(s => {
                            suitBonuses[s] = parsedBonuses[s] || 0;
                        });
                    }
                } else {
                    const storage = await yg.getStorage();
                    const savedData = await Promise.all([
                        storage.getItem('score'),
                        storage.getItem('maxCards'),
                        storage.getItem('suitBonuses')
                    ]);

                    score = savedData[0] ? parseInt(savedData[0]) : 0;
                    maxCards = savedData[1] ? parseInt(savedData[1]) : 2;
                    if(savedData[2]) {
                        const parsedBonuses = JSON.parse(savedData[2]);
                        suits.forEach(s => {
                            suitBonuses[s] = parsedBonuses[s] || 0;
                        });
                    }
                }

                updateMaxCardsButton();
                updateUpgrades();
                updateScore();
            } catch (error) {
                console.error("Ошибка загрузки:", error);
            }
        }

        async function saveProgress() {
            try {
                if (!yg) {
                    // Используем localStorage как fallback
                    localStorage.setItem('score', score.toString());
                    localStorage.setItem('maxCards', maxCards.toString());
                    localStorage.setItem('suitBonuses', JSON.stringify(suitBonuses));
                } else {
                    const storage = await yg.getStorage();
                    await storage.setItem('score', score.toString());
                    await storage.setItem('maxCards', maxCards.toString());
                    await storage.setItem('suitBonuses', JSON.stringify(suitBonuses));
                }
            } catch (error) {
                console.error("Ошибка сохранения прогресса:", error);
            }
        }

        function showAd() {
            document.getElementById('pause-screen').style.display = 'none';
            adReady = false;
			adActive = false;
            if (!yg) return;
            lastAdTime = Date.now();
            yg.adv.showFullscreenAdv({
                callbacks: {
                    onOpen: () => console.log("Реклама открыта"),
                    onClose: (wasShown) => console.log("Реклама закрыта", wasShown),
                    onError: (error) => console.error("Ошибка при показе рекламы", error)
                }
            });
        }

        init();
    </script>
</body>
</html>